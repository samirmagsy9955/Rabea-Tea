<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام الجودة - شركة باعشن</title>
   
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #667eea;
            --accent-color: #ff9800;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --gradient-primary: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            --gradient-secondary: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            --shadow-sm: 0 5px 15px rgba(0,0,0,0.1);
            --shadow-md: 0 10px 30px rgba(0,0,0,0.2);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.3);
            --border-radius: 15px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #2c5aa0, #1e3c72);
            background-size: 400% 400%;
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ========== LOADING PAGE STYLES ========== */
        .loading-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 30px;
        }

        .loading-page.hidden {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .tea-cup-container {
            position: relative;
            width: 150px;
            height: 150px;
        }

        /* Tea Cup */
        .tea-cup {
            position: absolute;
            width: 100px;
            height: 100px;
            border: 3px solid white;
            border-radius: 0 0 20px 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.1);
        }

        .tea-cup::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #8B4513 0%, #D2691E 100%);
            border-radius: 0 0 20px 20px;
            animation: fillTea 2s ease-in-out infinite;
            bottom: 0;
        }

        .tea-cup::after {
            content: '';
            position: absolute;
            width: 35px;
            height: 50px;
            border: 3px solid white;
            border-radius: 0 20px 20px 0;
            top: 20px;
            right: -40px;
        }

        @keyframes fillTea {
            0% { height: 0%; }
            50% { height: 100%; }
            100% { height: 0%; }
        }

        /* Tea Bag */
        .tea-bag {
            position: absolute;
            width: 30px;
            height: 40px;
            background: #8B4513;
            border-radius: 3px;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            animation: dunkTea 2s ease-in-out infinite;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .tea-bag::before {
            content: '';
            position: absolute;
            width: 2px;
            height: 25px;
            background: white;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
        }

        @keyframes dunkTea {
            0% { transform: translateX(-50%) translateY(0); }
            25% { transform: translateX(-50%) translateY(60px); }
            50% { transform: translateX(-50%) translateY(60px); }
            75% { transform: translateX(-50%) translateY(0); }
            100% { transform: translateX(-50%) translateY(0); }
        }

        /* Steam */
        .steam {
            position: absolute;
            width: 8px;
            height: 20px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            top: -30px;
        }

        .steam:nth-child(1) { left: 30%; animation: steamRise 1.5s ease-in infinite; }
        .steam:nth-child(2) { left: 50%; animation: steamRise 1.5s ease-in 0.3s infinite; }
        .steam:nth-child(3) { left: 70%; animation: steamRise 1.5s ease-in 0.6s infinite; }

        @keyframes steamRise {
            0% { opacity: 0; transform: translateY(0); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-40px); }
        }

        .loading-text {
            color: white;
            font-size: 1.5em;
            font-weight: 600;
            text-align: center;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loading-dots span {
            animation: blink 1.4s infinite;
        }

        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes blink {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ========== MAIN CONTENT STYLES ========== */
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-element {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        .floating-element:nth-child(1) { width: 80px; height: 80px; top: 10%; left: 10%; animation-delay: 0s; }
        .floating-element:nth-child(2) { width: 120px; height: 120px; top: 20%; right: 15%; animation-delay: -5s; }
        .floating-element:nth-child(3) { width: 60px; height: 60px; bottom: 20%; left: 20%; animation-delay: -10s; }
        .floating-element:nth-child(4) { width: 100px; height: 100px; bottom: 10%; right: 10%; animation-delay: -15s; }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            25% { transform: translateY(-100px) rotate(90deg); opacity: 0.7; }
            50% { transform: translateY(0) rotate(180deg); opacity: 1; }
            75% { transform: translateY(100px) rotate(270deg); opacity: 0.7; }
            100% { transform: translateY(0) rotate(360deg); opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: movePattern 20s linear infinite;
        }

        @keyframes movePattern {
            0% { transform: translate(0, 0); }
            100% { transform: translate(20px, 20px); }
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .logo {
            max-width: 150px;
            height: auto;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            transition: transform 0.6s ease;
        }

        .logo:hover { transform: rotateY(180deg); }

        .header h1 {
            font-size: 2em;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 30px 20px;
        }

        .form-section {
            display: none;
            opacity: 0;
            transform: translateX(50px);
            transition: all 0.5s ease;
        }

        .form-section.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.05em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1em;
            font-family: 'Cairo', sans-serif;
            transition: all var(--transition-speed);
            background: var(--light-color);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.2);
            transform: translateY(-2px);
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        .user-type-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .user-type-card {
            background: linear-gradient(135deg, var(--light-color) 0%, #ffffff 100%);
            border: 3px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .user-type-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .user-type-card.selected {
            border-color: var(--primary-color);
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .user-type-card i {
            font-size: 3em;
            color: var(--primary-color);
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .user-type-card.selected i {
            color: white;
        }

        .user-type-card h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .user-type-card.selected h3 {
            color: white;
        }

        .user-type-card p {
            font-size: 0.95em;
            color: #666;
            transition: all 0.3s ease;
        }

        .user-type-card.selected p {
            color: rgba(255, 255, 255, 0.9);
        }

        .question-container {
            background: linear-gradient(135deg, var(--light-color) 0%, #ffffff 100%);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border-right: 5px solid var(--primary-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .question-container:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .question-number {
            background: var(--gradient-primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            margin-left: 15px;
            font-size: 1.2em;
        }

        .question-text {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--dark-color);
            margin-right: 15px;
        }

        .answer-options {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .answer-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            text-align: center;
            font-weight: 600;
            color: var(--dark-color);
        }

        .answer-option:hover {
            border-color: var(--primary-color);
            background: rgba(44, 90, 160, 0.05);
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }

        .answer-option.selected {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--light-color);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-3px);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-3px);
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #20ba5a;
            transform: translateY(-3px);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .results-container {
            background: linear-gradient(135deg, var(--light-color) 0%, #ffffff 100%);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            margin-top: 30px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .results-header h2 {
            color: var(--primary-color);
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .score-display {
            font-size: 3em;
            font-weight: 900;
            color: var(--primary-color);
            margin: 20px 0;
        }

        .stars {
            font-size: 2em;
            color: #ffd700;
            margin: 15px 0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .result-card h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .result-card p {
            color: #666;
            font-size: 0.95em;
            margin: 5px 0;
        }

        .result-value {
            font-size: 1.5em;
            font-weight: 900;
            color: var(--primary-color);
            margin-top: 10px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 30px 0;
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .previous-results {
            margin-top: 30px;
        }

        .previous-results h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .results-timeline {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-right: 4px solid var(--primary-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            text-align: center;
        }

        .result-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .result-date {
            font-size: 0.85em;
            color: #999;
            margin-bottom: 10px;
        }

        .result-score {
            font-size: 1.8em;
            font-weight: 900;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .result-stars {
            font-size: 1.2em;
            color: #ffd700;
            margin: 10px 0;
        }

        .progress-analysis {
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            padding: 20px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--success-color);
            margin-top: 20px;
        }

        .progress-analysis h4 {
            color: var(--success-color);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .progress-item:last-child {
            border-bottom: none;
        }

        .progress-label {
            color: #333;
            font-weight: 600;
        }

        .progress-value {
            color: var(--success-color);
            font-weight: 900;
            font-size: 1.1em;
        }

        .progress-value.negative {
            color: var(--danger-color);
        }

        .admin-panel {
            background: linear-gradient(135deg, #f3e5f5 0%, #ede7f6 100%);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            border-left: 4px solid #9c27b0;
        }

        .admin-panel h3 {
            color: #7b1fa2;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .admin-stat {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .admin-stat-value {
            font-size: 2em;
            font-weight: 900;
            color: #7b1fa2;
            margin: 10px 0;
        }

        .admin-stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .hidden {
            display: none !important;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid var(--success-color);
        }

        .countdown-timer {
            background: linear-gradient(135deg, #fff3cd 0%, #ffecb5 100%);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 4px solid #ffc107;
            text-align: center;
            font-size: 1.1em;
            color: #856404;
        }

        .timer-display {
            font-size: 1.5em;
            font-weight: 900;
            color: #d35400;
            margin: 5px 0;
        }

        .complaint-success {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: var(--border-radius);
            border: 3px solid var(--success-color);
        }

        .complaint-success i {
            font-size: 4em;
            color: var(--success-color);
            margin-bottom: 20px;
        }

        .complaint-success h3 {
            color: var(--success-color);
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .complaint-success p {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.5em; }
            .header p { font-size: 1em; }
            .content { padding: 20px 15px; }
            .user-type-section { grid-template-columns: 1fr; }
            .answer-options { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: 1fr; }
            .results-timeline { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .btn { width: 100%; }
            .chart-container { height: 300px; }
            .question-text { font-size: 1em; }
            .logo { max-width: 120px; }
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { border-radius: 10px; }
            .header { padding: 20px 15px; }
            .header h1 { font-size: 1.3em; }
            .content { padding: 15px 10px; }
            .question-container { padding: 15px; margin-bottom: 15px; }
            .score-display { font-size: 2.5em; }
            .form-group input, .form-group select, .form-group textarea { padding: 10px 12px; font-size: 16px; }
            .admin-grid { grid-template-columns: 1fr; }
            .share-buttons { flex-direction: column; }
            .btn { min-width: auto; }
        }

        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; max-width: 100%; }
            .button-group, .btn, .admin-panel { display: none; }
            .results-container { page-break-inside: avoid; }
        }
    /* Tea Bag with Logo - Transparent Background */
.tea-bag {
    position: absolute;
    width: 60px;
    height: 80px;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    animation: dunkTea 2s ease-in-out infinite;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    border-radius: 8px 8px 15px 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    z-index: 10;
    background: transparent; /* خلفية شفافة */
    border: 2px solid rgba(255, 255, 255, 0.8); /* حد شبه شفاف */
    transition: all 0.3s ease;
}

.tea-bag::before {
    content: '';
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: 25px;
    background: linear-gradient(to top, #fff 0%, #f0f0f0 100%);
    z-index: 1;
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
}

.tea-bag::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        rgba(139, 69, 19, 0.1) 0%, 
        rgba(160, 82, 45, 0.1) 30%, 
        rgba(210, 105, 30, 0.1) 100%);
    border-radius: 8px 8px 15px 15px;
    z-index: -1;
    backdrop-filter: blur(2px);
}

.tea-bag img {
    width: 85%;
    height: 85%;
    object-fit: contain;
    border-radius: 5px;
    transition: all 0.5s ease;
    filter: 
        drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4))
        brightness(1.1)  /* زيادة الإضاءة */
        contrast(1.1);   /* زيادة التباين */
    animation: logoPulse 2s ease-in-out infinite alternate;
    background-color: transparent !important; /* خلفية شفافة للصورة */
    mix-blend-mode: multiply; /* مزج الألوان مع الخلفية */
}

.tea-bag:hover img {
    transform: scale(1.1) rotate(5deg);
    filter: 
        drop-shadow(0 4px 8px rgba(0, 0, 0, 0.6))
        brightness(1.2)
        contrast(1.2);
}

.tea-bag:hover {
    background: rgba(139, 69, 19, 0.05); /* خلفية شفافة جداً عند hover */
    border-color: rgba(255, 255, 255, 0.9);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.3),
        0 0 15px rgba(255, 255, 255, 0.3);
}

@keyframes logoPulse {
    0% {
        transform: scale(1);
        filter: 
            drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4))
            brightness(1.05)
            contrast(1.05);
    }
    100% {
        transform: scale(1.05);
        filter: 
            drop-shadow(0 3px 6px rgba(0, 0, 0, 0.5))
            brightness(1.15)
            contrast(1.15);
    }
}

/* حل بديل إذا كانت الصورة لا تزال تظهر بخلفية بيضاء */
/* استخدم فئة خاصة للصورة */
.tea-bag-logo {
    width: 85%;
    height: 85%;
    object-fit: contain;
    border-radius: 5px;
    transition: all 0.5s ease;
    filter: 
        drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4))
        brightness(1.1)
        contrast(1.1);
    animation: logoPulse 2s ease-in-out infinite alternate;
    background-color: transparent !important;
    mix-blend-mode: multiply;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
}

/* حل إضافي: إضافة سمة للصورة مباشرة في HTML */
img[src*="tea.png"] {
    background-color: transparent !important;
    background: transparent !important;
}

/* إذا كانت الصورة PNG مع خلفية بيضاء، يمكننا استخدام filter لإزالتها */
.tea-bag img.tea-logo {
    filter: 
        drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4))
        brightness(1.1)
        contrast(1.1)
        invert(0%); /* لا يوجد عكس */
}

/* أو استخدام blend-mode مختلف */
.tea-bag img {
    mix-blend-mode: normal; /* جرب normal, multiply, screen, overlay */
}

/* حل نهائي: استبدال الصورة بخلفية شفافة تماماً */
.tea-bag-logo-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
}

.tea-bag-logo-container img {
    max-width: 100%;
    max-height: 100%;
    background: transparent;
    background-color: transparent !important;
}
    </style>
</head>
<body>
    <!-- Loading Page -->
        <!-- Loading Page -->
    <div class="loading-page" id="loadingPage">
        <div class="tea-cup-container">
    <div class="tea-cup">
        <div class="steam"></div>
        <div class="steam"></div>
        <div class="steam"></div>
    </div>
    <div class="tea-bag">
        <div class="tea-bag-logo-container">
            <img src="tea.png" alt="شركة باعشن" class="tea-logo tea-bag-logo">
        </div>
    </div>
</div>
        
    </div>

    <!-- Floating Elements -->
    <div class="floating-elements">
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="لوجو.png" alt="شركة باعشن" class="logo">
            </div>
            <h1><i class="fas fa-clipboard-check"></i> نظام تقييم الجودة المتقدم</h1>
            <p>شركة أحمد محمد صالح باعشن وشركاه - جودة متفوقة منذ 1965</p>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- User Type Selection Section -->
            <div class="form-section active" id="userTypeSection">
                <h2 style="color: var(--primary-color); margin-bottom: 30px; text-align: center;">
                    <i class="fas fa-list-alt"></i> اختر الخدمة المطلوبة
                </h2>
                
                <div class="user-type-section">
                    <!-- بطاقة اختبار عامل الإنتاج -->
                    <div class="user-type-card" id="workerCard" onclick="selectService('test')">
                        <i class="fas fa-tasks"></i>
                        <h3>اختبار الجودة</h3>
                        <p>اختبار متخصص لعمال الإنتاج والتشغيل</p>
                    </div>
                    
                    <!-- بطاقة الشكاوى والمقترحات -->
                    <div class="user-type-card" id="complaintCard" onclick="selectService('complaint')">
                        <i class="fas fa-comments"></i>
                        <h3>الشكاوى والمقترحات</h3>
                        <p>أرسل شكواك أو مقترحاتك للإدارة</p>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="proceedBtn" onclick="proceedToNextSection()" disabled>
                        <i class="fas fa-arrow-left"></i> المتابعة
                    </button>
                </div>
            </div>

            <!-- User Information Section -->
            <div class="form-section" id="userInfoSection">
                <h2 style="color: var(--primary-color); margin-bottom: 30px; text-align: center;">
                    <i class="fas fa-user"></i> بيانات المستخدم
                </h2>

                <div class="form-group">
                    <label for="userName"><i class="fas fa-user"></i> الاسم الكامل</label>
                    <input type="text" id="userName" placeholder="أدخل اسمك الكامل">
                    <div class="error-message" id="nameError">الرجاء إدخال الاسم</div>
                </div>

                <div class="form-group">
                    <label for="userEmail"><i class="fas fa-envelope"></i> البريد الإلكتروني</label>
                    <input type="email" id="userEmail" placeholder="example@company.com">
                    <div class="error-message" id="emailError">الرجاء إدخال بريد إلكتروني صحيح</div>
                </div>

                <div class="form-group">
                    <label for="userPhone"><i class="fas fa-phone"></i> رقم الهاتف</label>
                    <input type="tel" id="userPhone" placeholder="01XXXXXXXXX">
                    <div class="error-message" id="phoneError">الرجاء إدخال رقم هاتف صحيح (01XXXXXXXXX)</div>
                </div>

                <div class="form-group">
                    <label for="userDepartment"><i class="fas fa-building"></i> القسم</label>
                    <select id="userDepartment">
                        <option value="">اختر القسم</option>
                        <option value="الإنتاج">الإنتاج</option>
                        <option value="الجودة">الجودة</option>
                        <option value="الصيانة">الصيانة</option>
                        <option value="المخازن">المخازن</option>
                        <option value="التعبئة">التعبئة</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                    <div class="error-message" id="deptError">الرجاء اختيار القسم</div>
                </div>

                <div class="form-group">
                    <label for="userPosition"><i class="fas fa-briefcase"></i> الوظيفة</label>
                    <select id="userPosition">
                        <option value="">اختر الوظيفة</option>
                        <option value="عامل إنتاج">عامل إنتاج</option>
                        <option value="عامل تجميع">عامل تجميع</option>
                        <option value="عامل فحص">عامل فحص</option>
                        <option value="عامل تعبئة">عامل تعبئة</option>
                        <option value="مشرف">مشرف</option>
                        <option value="فني">فني</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                    <div class="error-message" id="positionError">الرجاء اختيار الوظيفة</div>
                </div>

                <div class="form-group">
                    <label for="userExperience"><i class="fas fa-clock"></i> سنوات الخبرة</label>
                    <select id="userExperience">
                        <option value="">اختر سنوات الخبرة</option>
                        <option value="أقل من سنة">أقل من سنة</option>
                        <option value="1-3 سنوات">1-3 سنوات</option>
                        <option value="3-5 سنوات">3-5 سنوات</option>
                        <option value="5-10 سنوات">5-10 سنوات</option>
                        <option value="أكثر من 10 سنوات">أكثر من 10 سنوات</option>
                    </select>
                </div>

                <div id="savedDataIndicator" style="display: none;" class="success-message">
                    <i class="fas fa-check-circle"></i> تم تحميل بيانات المستخدم السابقة بنجاح
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="backToServiceSelection()">
                        <i class="fas fa-arrow-right"></i> رجوع
                    </button>
                    <button class="btn btn-primary" onclick="proceedBasedOnService()">
                        <i class="fas fa-play"></i> متابعة
                    </button>
                </div>
            </div>

            <!-- Quiz Section -->
            <div class="form-section" id="quizSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div style="text-align: center; margin-bottom: 20px; color: #666;">
                    <span id="questionCounter">1</span> من <span id="totalQuestions">15</span>
                </div>

                <div id="questionContainer"></div>

                <div class="button-group">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">
                        <i class="fas fa-arrow-right"></i> السؤال السابق
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>
                        <i class="fas fa-arrow-left"></i> السؤال التالي
                    </button>
                </div>
            </div>

            <!-- Complaint Section -->
            <div class="form-section" id="complaintSection">
                <h2 style="color: var(--primary-color); margin-bottom: 30px; text-align: center;">
                    <i class="fas fa-comment-dots"></i> الشكاوى والمقترحات
                </h2>

                <div class="form-group">
                    <label for="complaintType"><i class="fas fa-tag"></i> نوع الرسالة</label>
                    <select id="complaintType">
                        <option value="">اختر نوع الرسالة</option>
                        <option value="شكوى">شكوى</option>
                        <option value="اقتراح">اقتراح</option>
                        <option value="استفسار">استفسار</option>
                        <option value="تقييم">تقييم</option>
                    </select>
                    <div class="error-message" id="typeError">الرجاء اختيار نوع الرسالة</div>
                </div>

                <div class="form-group">
                    <label for="complaintTitle"><i class="fas fa-heading"></i> عنوان الرسالة</label>
                    <input type="text" id="complaintTitle" placeholder="أدخل عنواناً مختصراً">
                    <div class="error-message" id="titleError">الرجاء إدخال عنوان الرسالة</div>
                </div>

                <div class="form-group">
                    <label for="complaintMessage"><i class="fas fa-edit"></i> نص الرسالة</label>
                    <textarea id="complaintMessage" placeholder="أدخل تفاصيل شكواك أو اقتراحك هنا..."></textarea>
                    <div class="error-message" id="messageError">الرجاء إدخال نص الرسالة</div>
                </div>

                <div class="form-group">
                    <label for="complaintPriority"><i class="fas fa-exclamation-triangle"></i> الأولوية</label>
                    <select id="complaintPriority">
                        <option value="عادية">عادية</option>
                        <option value="متوسطة">متوسطة</option>
                        <option value="عالية">عالية</option>
                        <option value="عاجلة">عاجلة</option>
                    </select>
                </div>

                <div id="complaintSavedIndicator" style="display: none;" class="success-message">
                    <i class="fas fa-history"></i> لديك مسودة سابقة محفوظة
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="backToServiceSelection()">
                        <i class="fas fa-arrow-right"></i> رجوع
                    </button>
                    <button class="btn btn-success" onclick="saveComplaintDraft()">
                        <i class="fas fa-save"></i> حفظ مسودة
                    </button>
                    <button class="btn btn-whatsapp" onclick="sendComplaintViaWhatsApp()">
                        <i class="fab fa-whatsapp"></i> إرسال عبر واتساب
                    </button>
                </div>
            </div>

            <!-- Complaint Success Section -->
            <div class="form-section" id="complaintSuccessSection">
                <div class="complaint-success">
                    <i class="fas fa-check-circle"></i>
                    <h3>تم إرسال رسالتك بنجاح!</h3>
                    <p>شكراً لك على مشاركة شكواك/مقترحك معنا.</p>
                    <p>سيتم مراجعة رسالتك من قبل الإدارة في أقرب وقت.</p>
                    <p>رقم المرجع: <strong id="complaintReference">REF-2024-001</strong></p>
                    
                    <div class="button-group" style="margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="sendAnotherComplaint()">
                            <i class="fas fa-plus"></i> إرسال رسالة أخرى
                        </button>
                        <button class="btn btn-primary" onclick="goToServiceSelection()">
                            <i class="fas fa-home"></i> الصفحة الرئيسية
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="form-section" id="resultsSection">
                <div class="results-container">
                    <div class="results-header">
                        <h2><i class="fas fa-trophy"></i> نتائج الاختبار</h2>
                        <p id="resultUserName" style="color: #666; margin-top: 10px;"></p>
                    </div>

                    <!-- Countdown Timer for Auto-Send -->
                    <div id="countdownTimer" class="countdown-timer" style="display: none;">
                        <i class="fas fa-clock"></i> سيتم إرسال النتائج تلقائياً عبر واتساب خلال:
                        <div class="timer-display" id="timerDisplay">3 ثواني</div>
                        <p style="font-size: 0.9em; margin-top: 5px;">يمكنك إلغاء الإرسال التلقائي بالضغط على أي زر</p>
                    </div>

                    <div style="text-align: center;">
                        <div class="score-display" id="scoreDisplay">0/15</div>
                        <div class="stars" id="starsDisplay"></div>
                        <p id="scoreMessage" style="font-size: 1.2em; color: #666; margin-top: 20px;"></p>
                    </div>

                    <div class="results-grid">
                        <div class="result-card">
                            <h4><i class="fas fa-check-circle"></i> النتيجة</h4>
                            <div class="result-value" id="finalScore">0</div>
                            <p>من 15 نقطة</p>
                        </div>
                        <div class="result-card">
                            <h4><i class="fas fa-percent"></i> النسبة المئوية</h4>
                            <div class="result-value" id="percentageScore">0%</div>
                            <p>من المجموع الكلي</p>
                        </div>
                        <div class="result-card">
                            <h4><i class="fas fa-clock"></i> وقت الاختبار</h4>
                            <div class="result-value" id="testDuration">0</div>
                            <p>دقيقة</p>
                        </div>
                    </div>

                    <!-- Progress Analysis -->
                    <div id="progressAnalysisContainer" style="display: none;">
                        <div class="progress-analysis">
                            <h4><i class="fas fa-chart-line"></i> تحليل التقدم</h4>
                            <div id="progressAnalysisContent"></div>
                        </div>
                    </div>

                    <!-- Chart Container -->
                    <div id="chartContainer" style="display: none;">
                        <h3 style="color: var(--primary-color); margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-chart-bar"></i> رسم بياني للنتائج
                        </h3>
                        <div class="chart-container">
                            <canvas id="resultsChart"></canvas>
                        </div>
                    </div>

                    <!-- Previous Results -->
                    <div id="previousResults" class="previous-results" style="display: none;">
                        <h3><i class="fas fa-history"></i> السجل السابق</h3>
                        <div class="results-timeline" id="previousResultsContainer"></div>
                    </div>

                    <!-- Admin Panel -->
                    <div class="admin-panel">
                        <h3><i class="fas fa-chart-pie"></i> لوحة الإحصائيات</h3>
                        <div class="admin-grid">
                            <div class="admin-stat">
                                <div class="admin-stat-label">إجمالي الاختبارات</div>
                                <div class="admin-stat-value" id="totalTests">0</div>
                            </div>
                            <div class="admin-stat">
                                <div class="admin-stat-label">أفضل نتيجة</div>
                                <div class="admin-stat-value" id="bestScore">0</div>
                            </div>
                            <div class="admin-stat">
                                <div class="admin-stat-label">متوسط النتائج</div>
                                <div class="admin-stat-value" id="averageScore">0</div>
                            </div>
                            <div class="admin-stat">
                                <div class="admin-stat-label">معدل التحسن</div>
                                <div class="admin-stat-value" id="improvementRate">0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Share Buttons -->
                    <div class="share-buttons">
                        <button class="btn btn-whatsapp" onclick="shareTestResultsViaWhatsApp()" id="whatsappBtn">
                            <i class="fab fa-whatsapp"></i> إرسال النتائج عبر واتساب
                        </button>
                        <button class="btn btn-secondary" onclick="restartTest()">
                            <i class="fas fa-redo"></i> إعادة الاختبار
                        </button>
                    </div>

                    <div class="button-group" style="margin-top: 30px;">
                        <button class="btn btn-danger" onclick="clearAllData()">
                            <i class="fas fa-trash"></i> حذف جميع البيانات
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

        
        
        
        <!-- نسخة أبسط -->
<footer style="
    background: #2c5aa0;
    color: white;
    padding: 15px;
    text-align: center;
    font-family: Arial, sans-serif;
    border-top: 3px solid #25D366;
">
    <div style="display: flex; justify-content: center; align-items: center; gap: 15px;">
        <span style="font-size: 14px;">
            Made by <strong>Eng SAMIR MAGDY</strong>
        </span>
        
        <a href="https://samermagdy1.github.io/C-V/" 
           target="_blank"
           title="View Portfolio"
           style="
                display: inline-block;
                width: 40px;
                height: 40px;
                background: #25D366;
                border-radius: 50%;
                color: white;
                text-decoration: none;
                text-align: center;
                line-height: 40px;
                animation: pulse 2s infinite;
                position: relative;
            ">
            <i class="fas fa-external-link-alt"></i>
        </a>
    </div>
    
    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        a:hover {
            animation-play-state: paused;
            background: #20ba5a !important;
        }
    </style>
</footer>
    <script>
        // ========== VARIABLES ==========
        let currentService = ''; // 'test' or 'complaint'
        let userData = {};
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let quizData = [];
        let previousResults = [];
        let testStartTime = 0;
        let testEndTime = 0;
        let autoSendTimer = null;
        let countdown = 3;
        let autoSendEnabled = true;
        let complaintDraft = null;

        // Worker Quiz Data - تعليمات دخول صالة الإنتاج (15 سؤالاً)
        const workerQuizData = [
            {
                question: "أي مما يلي يعتبر من متطلبات النظافة الشخصية قبل دخول صالة الإنتاج؟",
                options: ["عدم الحاجة للاستحمام", "استخدام العطور القوية", "الاستحمام، غسيل الأسنان، قص الأظافر والحلاقة"],
                correct: 2
            },
            {
                question: "ما هو الزي الصحيح قبل دخول الصالة؟",
                options: ["أي ملابس عادية مناسبة", "يونيفورم نظيف + غطاء رأس + غطاء ذقن + كمامة (حسب الحاجة) + أحذية مخصصة", "ارتداء القفازات فقط بدون باقي الزي"],
                correct: 1
            },
            {
                question: "ارتداء غطاء الرأس:",
                options: ["اختياري حسب رغبة العامل", "إجباري دائماً", "فقط عند وجود تفتيش"],
                correct: 1
            },
            {
                question: "القفازات تستخدم:",
                options: ["في جميع الأقسام حتى لو غير مطلوبة", "غير ضرورية", "حسب طبيعة العملية وتعليمات الجودة"],
                correct: 2
            },
            {
                question: "يجب غسل اليدين لمدة:",
                options: ["10 ثوانٍ", "30 ثانية", "60 ثانية"],
                correct: 1
            },
            {
                question: "مما يلي مواد ممنوع دخولها الصالة:",
                options: ["العملات المعدنية – المفاتيح – أدوات حادة غير مصرح بها", "الموبايل فقط", "المفاتيح فقط"],
                correct: 0
            },
            {
                question: "ما هو الصحيح؟",
                options: ["مسموح بوضع ميكياج خفيف", "مسموح بطلاء الأظافر", "ممنوع وضع أي مساحيق أو ميكياج أو طلاء أظافر أو رموش صناعية"],
                correct: 2
            },
            {
                question: "متطلب شكل الأظافر:",
                options: ["يمكن أن تكون طويلة بشرط نظافتها", "قصيرة دائماً", "غير مهم طولها"],
                correct: 1
            },
            {
                question: "هل يسمح بوضع العطور؟",
                options: ["نعم", "حسب نوع العطر", "لا"],
                correct: 2
            },
            {
                question: "عند حدوث تلوث أو انسكاب أو كسر زجاج:",
                options: ["تجاهل الأمر", "تنظيف المشكلة بنفسك", "إبلاغ المشرف فوراً"],
                correct: 2
            },
            {
                question: "المخلفات توضع في:",
                options: ["أي مكان", "سلات (صناديق/حاويات) مخصصة فقط", "خارج الصالة"],
                correct: 1
            },
            {
                question: "يجب تغيير الجوانتي (القفازات) عندما:",
                options: ["يحدث قطع أو يتلوث أو يلمس سطح خارج منطقة العمل", "كل يوم مرة واحدة", "فقط عند طلب المشرف"],
                correct: 0
            },
            {
                question: "أي مما يلي يمنع دخول العامل إلى الصالة؟",
                options: ["إسهال - قيء - إفرازات الأنف أو الأذن - اصفرار العين - أمراض جلدية", "الصداع فقط", "الإرهاق"],
                correct: 0
            },
            {
                question: "الدخول والخروج يتم عن طريق:",
                options: ["أي باب متاح", "الأبواب المخصصة فقط", "بوابة المخزن"],
                correct: 1
            },
            {
                question: "خلال العمل يجب:",
                options: ["خلع غطاء الرأس عند الشعور بالحر", "ارتداء الزي فقط عند وجود تفتيش", "الالتزام بالزي الكامل طوال مدة العمل دون تعديل"],
                correct: 2
            }
        ];

        // ========== INITIALIZATION ==========
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loadingPage').classList.add('hidden');
            }, 2000);

            loadUserData();
            loadPreviousResults();
            loadComplaintDraft();
            
            // تعبئة بيانات المستخدم إذا كانت محفوظة
            fillUserDataIfSaved();
        });

        // ========== LOAD DATA FROM LOCALSTORAGE ==========
        function loadUserData() {
            const saved = localStorage.getItem('qualityAssessmentUserData');
            if (saved) {
                userData = JSON.parse(saved);
            }
        }

        function loadPreviousResults() {
            const saved = localStorage.getItem('qualityAssessmentResults');
            if (saved) {
                previousResults = JSON.parse(saved);
            }
        }

        function loadComplaintDraft() {
            const saved = localStorage.getItem('qualityComplaintDraft');
            if (saved) {
                complaintDraft = JSON.parse(saved);
            }
        }

        function fillUserDataIfSaved() {
            if (userData.name) {
                document.getElementById('userName').value = userData.name || '';
                document.getElementById('userEmail').value = userData.email || '';
                document.getElementById('userPhone').value = userData.phone || '';
                document.getElementById('userDepartment').value = userData.department || '';
                document.getElementById('userPosition').value = userData.position || '';
                document.getElementById('userExperience').value = userData.experience || '';
                
                if (userData.name) {
                    document.getElementById('savedDataIndicator').style.display = 'block';
                }
            }
        }

        // ========== SERVICE SELECTION ==========
        function selectService(service) {
            currentService = service;
            
            document.getElementById('workerCard').classList.remove('selected');
            document.getElementById('complaintCard').classList.remove('selected');
            
            if (service === 'test') {
                document.getElementById('workerCard').classList.add('selected');
                document.getElementById('proceedBtn').innerHTML = '<i class="fas fa-arrow-left"></i> بدء اختبار الجودة';
            } else {
                document.getElementById('complaintCard').classList.add('selected');
                document.getElementById('proceedBtn').innerHTML = '<i class="fas fa-arrow-left"></i> إرسال شكوى/مقترح';
            }
            
            document.getElementById('proceedBtn').disabled = false;
        }

        function proceedToNextSection() {
            if (!currentService) return;
            
            document.getElementById('userTypeSection').classList.remove('active');
            document.getElementById('userInfoSection').classList.add('active');
        }

        function backToServiceSelection() {
            document.getElementById('userInfoSection').classList.remove('active');
            document.getElementById('quizSection').classList.remove('active');
            document.getElementById('complaintSection').classList.remove('active');
            document.getElementById('userTypeSection').classList.add('active');
        }

        // ========== VALIDATION ==========
        function validateUserInfo() {
            let isValid = true;
            
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const phone = document.getElementById('userPhone').value.trim();
            const department = document.getElementById('userDepartment').value;
            const position = document.getElementById('userPosition').value;

            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');

            if (!name) {
                document.getElementById('nameError').style.display = 'block';
                isValid = false;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                document.getElementById('emailError').style.display = 'block';
                isValid = false;
            }

            const phoneRegex = /^01[0-9]{9}$/;
            if (!phone || !phoneRegex.test(phone)) {
                document.getElementById('phoneError').style.display = 'block';
                isValid = false;
            }

            if (!department) {
                document.getElementById('deptError').style.display = 'block';
                isValid = false;
            }

            if (!position) {
                document.getElementById('positionError').style.display = 'block';
                isValid = false;
            }

            if (isValid) {
                userData = {
                    name: name,
                    email: email,
                    phone: phone,
                    department: department,
                    position: position,
                    experience: document.getElementById('userExperience').value || 'غير محدد',
                    lastUpdated: new Date().toISOString()
                };
                
                localStorage.setItem('qualityAssessmentUserData', JSON.stringify(userData));
                document.getElementById('savedDataIndicator').style.display = 'block';
            }

            return isValid;
        }

        // ========== PROCEED BASED ON SERVICE ==========
        function proceedBasedOnService() {
            if (!validateUserInfo()) {
                return;
            }

            if (currentService === 'test') {
                startTest();
            } else {
                startComplaint();
            }
        }

        // ========== TEST FUNCTIONS ==========
        function startTest() {
            quizData = workerQuizData;

            document.getElementById('userInfoSection').classList.remove('active');
            document.getElementById('quizSection').classList.add('active');
            
            currentQuestion = 0;
            userAnswers = new Array(quizData.length).fill(null);
            score = 0;
            testStartTime = Date.now();
            
            document.getElementById('totalQuestions').textContent = quizData.length;
            document.getElementById('nextBtn').disabled = true;
            displayQuestion();
        }

        function displayQuestion() {
            const question = quizData[currentQuestion];
            const container = document.getElementById('questionContainer');
            
            let html = `
                <div class="question-container">
                    <div>
                        <span class="question-number">${currentQuestion + 1}</span>
                        <span class="question-text">${question.question}</span>
                    </div>
                    <div class="answer-options">
            `;

            question.options.forEach((option, index) => {
                const isSelected = userAnswers[currentQuestion] === index;
                html += `
                    <div class="answer-option ${isSelected ? 'selected' : ''}" onclick="selectAnswer(${index})">
                        ${option}
                    </div>
                `;
            });

            html += '</div></div>';
            container.innerHTML = html;

            updateProgressBar();
            updateQuestionCounter();
            updateNavigationButtons();
        }

        function selectAnswer(index) {
            userAnswers[currentQuestion] = index;
            const question = quizData[currentQuestion];
            
            // إعادة حساب النتيجة
            score = 0;
            for (let i = 0; i <= currentQuestion; i++) {
                if (userAnswers[i] === quizData[i].correct) {
                    score++;
                }
            }

            displayQuestion();
            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            if (userAnswers[currentQuestion] === null) {
                alert("الرجاء الإجابة على السؤال الحالي قبل الانتقال للسؤال التالي");
                return;
            }

            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                displayQuestion();
                document.getElementById('nextBtn').disabled = true;
            } else {
                finishTest();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                displayQuestion();
                // تمكين زر التالي إذا كان هناك إجابة على السؤال السابق
                document.getElementById('nextBtn').disabled = userAnswers[currentQuestion] === null;
            }
        }

        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateQuestionCounter() {
            document.getElementById('questionCounter').textContent = currentQuestion + 1;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (currentQuestion > 0) {
                prevBtn.style.display = 'inline-flex';
            } else {
                prevBtn.style.display = 'none';
            }

            if (currentQuestion === quizData.length - 1) {
                nextBtn.innerHTML = '<i class="fas fa-check"></i> إنهاء الاختبار';
            } else {
                nextBtn.innerHTML = '<i class="fas fa-arrow-left"></i> السؤال التالي';
            }
        }

        // ========== TEST RESULTS ==========
        function finishTest() {
            testEndTime = Date.now();
            const testDuration = Math.round((testEndTime - testStartTime) / 60000);
            
            saveTestResults(testDuration);
            displayTestResults(testDuration);
            
            // بدء المؤقت للإرسال التلقائي
            startAutoSendTimer();
        }

        function saveTestResults(duration) {
            const result = {
                name: userData.name,
                score: score,
                duration: duration,
                date: new Date().toLocaleDateString('ar-SA'),
                timestamp: new Date().getTime(),
                percentage: (score / quizData.length) * 100,
                department: userData.department,
                position: userData.position
            };
            
            previousResults.unshift(result);
            
            if (previousResults.length > 20) {
                previousResults = previousResults.slice(0, 20);
            }
            
            localStorage.setItem('qualityAssessmentResults', JSON.stringify(previousResults));
        }

        function displayTestResults(duration) {
            document.getElementById('quizSection').classList.remove('active');
            document.getElementById('resultsSection').classList.add('active');

            const percentage = (score / quizData.length) * 100;
            const maxScore = quizData.length;

            // Display score
            document.getElementById('scoreDisplay').textContent = `${score}/${maxScore}`;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('percentageScore').textContent = percentage.toFixed(1) + '%';
            document.getElementById('testDuration').textContent = duration;
            document.getElementById('resultUserName').textContent = `${userData.name} - ${userData.position} - ${userData.department}`;

            // Display stars
            const stars = getStarRating(percentage);
            document.getElementById('starsDisplay').innerHTML = stars;

            // Display message
            let message = '';
            if (percentage >= 90) {
                message = 'ممتاز! أداء استثنائي جداً';
            } else if (percentage >= 80) {
                message = 'جيد جداً! أداء قوية';
            } else if (percentage >= 70) {
                message = 'جيد! أداء مقبولة';
            } else if (percentage >= 60) {
                message = 'مقبول! يحتاج إلى تحسن';
            } else {
                message = 'يحتاج إلى مراجعة وتحسن';
            }
            document.getElementById('scoreMessage').textContent = message;

            // Display progress analysis
            displayProgressAnalysis();

            // Display chart
            displayChart();

            // Display previous results
            displayPreviousResults();

            // Display admin stats
            displayAdminStats();
        }

        function getStarRating(percentage) {
            const fullStars = Math.floor(percentage / 20);
            let stars = '';
            for (let i = 0; i < 5; i++) {
                if (i < fullStars) {
                    stars += '<i class="fas fa-star"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        // ========== AUTO-SEND TIMER ==========
        function startAutoSendTimer() {
            countdown = 3;
            autoSendEnabled = true;
            
            document.getElementById('countdownTimer').style.display = 'block';
            document.getElementById('timerDisplay').textContent = countdown + ' ثواني';
            
            autoSendTimer = setInterval(() => {
                countdown--;
                document.getElementById('timerDisplay').textContent = countdown + ' ثواني';
                
                if (countdown <= 0) {
                    clearInterval(autoSendTimer);
                    if (autoSendEnabled) {
                        autoSendTestResultsViaWhatsApp();
                    }
                    document.getElementById('countdownTimer').style.display = 'none';
                }
            }, 1000);
            
            // إلغاء المؤثر عند الضغط على أي زر
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    clearInterval(autoSendTimer);
                    autoSendEnabled = false;
                    document.getElementById('countdownTimer').style.display = 'none';
                });
            });
        }

        // ========== WHATSAPP AUTO-SEND FOR TEST RESULTS ==========
        function autoSendTestResultsViaWhatsApp() {
            const currentResult = previousResults[0];
            const percentage = currentResult.percentage.toFixed(1);

            let message = `*نتائج اختبار الجودة - شركة باعشن*\n\n`;
            message += `👤 الاسم: ${userData.name}\n`;
            message += `💼 الوظيفة: ${userData.position}\n`;
            message += `🏢 القسم: ${userData.department}\n`;
            message += `📊 النتيجة: ${currentResult.score}/${quizData.length}\n`;
            message += `📈 النسبة المئوية: ${percentage}%\n`;
            message += `⏱️ وقت الاختبار: ${currentResult.duration} دقيقة\n`;
            message += `📅 التاريخ: ${currentResult.date}\n`;
            message += `🎯 نوع الاختبار: اختبار عامل الإنتاج\n\n`;

            // Add progress analysis
            if (previousResults.length >= 2) {
                const previousResult = previousResults[1];
                const scoreDiff = currentResult.score - previousResult.score;
                const percentDiff = currentResult.percentage - previousResult.percentage;

                message += `*📊 تحليل التقدم:*\n`;
                message += `التحسن في النقاط: ${scoreDiff >= 0 ? '+' : ''}${scoreDiff}\n`;
                message += `التحسن في النسبة: ${percentDiff >= 0 ? '+' : ''}${percentDiff.toFixed(1)}%\n`;
                message += `النتيجة السابقة: ${previousResult.score}/${quizData.length}\n\n`;
            }

            message += `✅ تم إنشاء النتيجة تلقائياً بواسطة نظام تقييم الجودة`;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/+201129724884?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // ========== MANUAL WHATSAPP SHARE FOR TEST RESULTS ==========
        function shareTestResultsViaWhatsApp() {
            const currentResult = previousResults[0];
            const percentage = currentResult.percentage.toFixed(1);

            let message = `*نتائج اختبار الجودة - شركة باعشن*\n\n`;
            message += `👤 الاسم: ${userData.name}\n`;
            message += `💼 الوظيفة: ${userData.position}\n`;
            message += `🏢 القسم: ${userData.department}\n`;
            message += `📊 النتيجة: ${currentResult.score}/${quizData.length}\n`;
            message += `📈 النسبة المئوية: ${percentage}%\n`;
            message += `⏱️ وقت الاختبار: ${currentResult.duration} دقيقة\n`;
            message += `📅 التاريخ: ${currentResult.date}\n`;
            message += `🎯 نوع الاختبار: اختبار عامل الإنتاج\n\n`;

            // Add progress analysis
            if (previousResults.length >= 2) {
                const previousResult = previousResults[1];
                const scoreDiff = currentResult.score - previousResult.score;
                const percentDiff = currentResult.percentage - previousResult.percentage;

                message += `*📊 تحليل التقدم:*\n`;
                message += `التحسن في النقاط: ${scoreDiff >= 0 ? '+' : ''}${scoreDiff}\n`;
                message += `التحسن في النسبة: ${percentDiff >= 0 ? '+' : ''}${percentDiff.toFixed(1)}%\n`;
                message += `النتيجة السابقة: ${previousResult.score}/${quizData.length}\n\n`;

                if (previousResults.length >= 3) {
                    const thirdResult = previousResults[2];
                    const trendDiff = currentResult.score - thirdResult.score;
                    const trendLabel = trendDiff > 0 ? '📈 تحسن مستمر' : (trendDiff < 0 ? '📉 تراجع' : '➡️ استقرار');
                    message += `الاتجاه العام: ${trendLabel}\n\n`;
                }
            }

            // Add statistics
            if (previousResults.length > 1) {
                const bestScore = Math.max(...previousResults.map(r => r.score));
                const averageScore = (previousResults.reduce((sum, r) => sum + r.score, 0) / previousResults.length).toFixed(1);

                message += `*📈 إحصائيات عامة:*\n`;
                message += `إجمالي الاختبارات: ${previousResults.length}\n`;
                message += `أفضل نتيجة: ${bestScore}/${quizData.length}\n`;
                message += `متوسط النتائج: ${averageScore}/${quizData.length}\n\n`;
            }

            message += `✅ تم إنشاء النتيجة بواسطة نظام تقييم الجودة - شركة باعشن`;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/+201129724884?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // ========== PROGRESS ANALYSIS ==========
        function displayProgressAnalysis() {
            if (previousResults.length < 2) {
                document.getElementById('progressAnalysisContainer').style.display = 'none';
                return;
            }

            document.getElementById('progressAnalysisContainer').style.display = 'block';

            const currentResult = previousResults[0];
            const previousResult = previousResults[1];

            const scoreDiff = currentResult.score - previousResult.score;
            const percentDiff = currentResult.percentage - previousResult.percentage;

            let html = `
                <div class="progress-item">
                    <span class="progress-label">التحسن في النقاط</span>
                    <span class="progress-value ${scoreDiff >= 0 ? '' : 'negative'}">
                        ${scoreDiff >= 0 ? '+' : ''}${scoreDiff}
                    </span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">التحسن في النسبة المئوية</span>
                    <span class="progress-value ${percentDiff >= 0 ? '' : 'negative'}">
                        ${percentDiff >= 0 ? '+' : ''}${percentDiff.toFixed(1)}%
                    </span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">النتيجة السابقة</span>
                    <span class="progress-value">${previousResult.score}/${quizData.length}</span>
                </div>
            `;

            if (previousResults.length >= 3) {
                const thirdResult = previousResults[2];
                const trendDiff = currentResult.score - thirdResult.score;
                const trendLabel = trendDiff > 0 ? 'تحسن مستمر' : (trendDiff < 0 ? 'تراجع' : 'استقرار');
                
                html += `
                    <div class="progress-item">
                        <span class="progress-label">الاتجاه العام (آخر 3 اختبارات)</span>
                        <span class="progress-value">${trendLabel}</span>
                    </div>
                `;
            }

            document.getElementById('progressAnalysisContent').innerHTML = html;
        }

        // ========== CHART DISPLAY ==========
        function displayChart() {
            if (previousResults.length < 2) {
                document.getElementById('chartContainer').style.display = 'none';
                return;
            }

            document.getElementById('chartContainer').style.display = 'block';

            const limitedResults = previousResults.slice(0, 10).reverse();
            const labels = limitedResults.map((r, i) => `${i + 1}`);
            const scores = limitedResults.map(r => r.score);
            const percentages = limitedResults.map(r => r.percentage);

            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            if (window.resultsChartInstance) {
                window.resultsChartInstance.destroy();
            }

            window.resultsChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'النقاط',
                            data: scores,
                            borderColor: '#2c5aa0',
                            backgroundColor: 'rgba(44, 90, 160, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#2c5aa0',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'النسبة المئوية (%)',
                            data: percentages,
                            borderColor: '#ff9800',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#ff9800',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { family: "'Cairo', sans-serif", size: 14, weight: 'bold' },
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 15,
                            ticks: {
                                font: { family: "'Cairo', sans-serif", size: 12 }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: { family: "'Cairo', sans-serif", size: 12 }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ========== DISPLAY PREVIOUS RESULTS ==========
        function displayPreviousResults() {
            if (previousResults.length < 2) {
                document.getElementById('previousResults').style.display = 'none';
                return;
            }

            document.getElementById('previousResults').style.display = 'block';

            const resultsToShow = previousResults.slice(0, 10);
            let html = '';

            resultsToShow.forEach((result, index) => {
                const starRating = getStarRating(result.percentage);
                html += `
                    <div class="result-item">
                        <div class="result-date">${result.date}</div>
                        <div class="result-score">${result.score}/${quizData.length}</div>
                        <div class="result-stars">${starRating}</div>
                        <div style="font-size: 0.9em; color: #666;">${(result.percentage).toFixed(1)}%</div>
                    </div>
                `;
            });

            document.getElementById('previousResultsContainer').innerHTML = html;
        }

        // ========== ADMIN STATS ==========
        function displayAdminStats() {
            const totalTests = previousResults.length;
            const bestScore = totalTests > 0 ? Math.max(...previousResults.map(r => r.score)) : 0;
            const averageScore = totalTests > 0 ? (previousResults.reduce((sum, r) => sum + r.score, 0) / totalTests).toFixed(1) : 0;

            let improvementRate = 0;
            if (previousResults.length >= 2) {
                const recent = previousResults.slice(0, 5);
                const older = previousResults.slice(5, 10);
                
                if (older.length > 0) {
                    const recentAvg = recent.reduce((sum, r) => sum + r.score, 0) / recent.length;
                    const olderAvg = older.reduce((sum, r) => sum + r.score, 0) / older.length;
                    improvementRate = olderAvg > 0 ? (((recentAvg - olderAvg) / olderAvg) * 100).toFixed(1) : 0;
                }
            }

            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('bestScore').textContent = bestScore;
            document.getElementById('averageScore').textContent = averageScore;
            document.getElementById('improvementRate').textContent = improvementRate + '%';
        }

        // ========== COMPLAINT FUNCTIONS ==========
        function startComplaint() {
            document.getElementById('userInfoSection').classList.remove('active');
            document.getElementById('complaintSection').classList.add('active');
            
            // تحميل المسودة إذا وجدت
            loadComplaintDraftToForm();
        }

        function loadComplaintDraftToForm() {
            if (complaintDraft) {
                document.getElementById('complaintType').value = complaintDraft.type || '';
                document.getElementById('complaintTitle').value = complaintDraft.title || '';
                document.getElementById('complaintMessage').value = complaintDraft.message || '';
                document.getElementById('complaintPriority').value = complaintDraft.priority || 'عادية';
                
                document.getElementById('complaintSavedIndicator').style.display = 'block';
            }
        }

        function saveComplaintDraft() {
            const type = document.getElementById('complaintType').value;
            const title = document.getElementById('complaintTitle').value.trim();
            const message = document.getElementById('complaintMessage').value.trim();
            const priority = document.getElementById('complaintPriority').value;

            complaintDraft = {
                type: type,
                title: title,
                message: message,
                priority: priority,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('qualityComplaintDraft', JSON.stringify(complaintDraft));
            
            alert('تم حفظ المسودة بنجاح! يمكنك العودة لإكمالها لاحقاً.');
        }

        function validateComplaint() {
            let isValid = true;
            
            const type = document.getElementById('complaintType').value;
            const title = document.getElementById('complaintTitle').value.trim();
            const message = document.getElementById('complaintMessage').value.trim();

            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');

            if (!type) {
                document.getElementById('typeError').style.display = 'block';
                isValid = false;
            }

            if (!title) {
                document.getElementById('titleError').style.display = 'block';
                isValid = false;
            }

            if (!message) {
                document.getElementById('messageError').style.display = 'block';
                isValid = false;
            }

            return isValid;
        }

        function sendComplaintViaWhatsApp() {
            if (!validateComplaint()) {
                return;
            }

            const type = document.getElementById('complaintType').value;
            const title = document.getElementById('complaintTitle').value.trim();
            const message = document.getElementById('complaintMessage').value.trim();
            const priority = document.getElementById('complaintPriority').value;
            
            const reference = 'REF-' + new Date().getFullYear() + '-' + Math.floor(Math.random() * 1000);

            let whatsappMessage = `*${type} - شركة باعشن*\n\n`;
            whatsappMessage += `👤 المرسل: ${userData.name}\n`;
            whatsappMessage += `📞 الهاتف: ${userData.phone}\n`;
            whatsappMessage += `📧 البريد: ${userData.email}\n`;
            whatsappMessage += `🏢 القسم: ${userData.department}\n`;
            whatsappMessage += `💼 الوظيفة: ${userData.position}\n`;
            whatsappMessage += `🏷️ الأولوية: ${priority}\n`;
            whatsappMessage += `🔖 المرجع: ${reference}\n\n`;
            whatsappMessage += `*${title}*\n`;
            whatsappMessage += `${message}\n\n`;
            whatsappMessage += `📅 التاريخ: ${new Date().toLocaleDateString('ar-SA')}\n`;
            whatsappMessage += `⏰ الوقت: ${new Date().toLocaleTimeString('ar-SA')}\n\n`;
            whatsappMessage += `✅ تم إرسال هذه الرسالة عبر نظام الشكاوى والمقترحات`;

            const encodedMessage = encodeURIComponent(whatsappMessage);
            const whatsappUrl = `https://wa.me/+201129724884?text=${encodedMessage}`;
            
            // حفظ البيانات
            saveComplaintData(type, title, message, priority, reference);
            
            // حذف المسودة بعد الإرسال
            localStorage.removeItem('qualityComplaintDraft');
            complaintDraft = null;
            
            // عرض شاشة النجاح
            showComplaintSuccess(reference);
            
            // فتح واتساب في نافذة جديدة
            window.open(whatsappUrl, '_blank');
        }

        function saveComplaintData(type, title, message, priority, reference) {
            const complaintData = {
                type: type,
                title: title,
                message: message,
                priority: priority,
                reference: reference,
                sender: userData.name,
                phone: userData.phone,
                email: userData.email,
                department: userData.department,
                position: userData.position,
                date: new Date().toISOString()
            };
            
            // حفظ في localStorage للتاريخ
            const complaints = JSON.parse(localStorage.getItem('qualityComplaints') || '[]');
            complaints.unshift(complaintData);
            
            if (complaints.length > 50) {
                complaints = complaints.slice(0, 50);
            }
            
            localStorage.setItem('qualityComplaints', JSON.stringify(complaints));
        }

        function showComplaintSuccess(reference) {
            document.getElementById('complaintSection').classList.remove('active');
            document.getElementById('complaintSuccessSection').classList.add('active');
            document.getElementById('complaintReference').textContent = reference;
        }

        function sendAnotherComplaint() {
            document.getElementById('complaintSuccessSection').classList.remove('active');
            document.getElementById('complaintSection').classList.add('active');
            
            // مسح النموذج
            document.getElementById('complaintType').value = '';
            document.getElementById('complaintTitle').value = '';
            document.getElementById('complaintMessage').value = '';
            document.getElementById('complaintPriority').value = 'عادية';
            document.getElementById('complaintSavedIndicator').style.display = 'none';
        }

        function goToServiceSelection() {
            document.getElementById('complaintSuccessSection').classList.remove('active');
            document.getElementById('userTypeSection').classList.add('active');
        }

        // ========== RESTART TEST ==========
        function restartTest() {
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('userTypeSection').classList.add('active');
            
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            
            // إلغاء أي مؤقتات نشطة
            if (autoSendTimer) {
                clearInterval(autoSendTimer);
            }
        }

        // ========== CLEAR DATA ==========
        function clearAllData() {
            if (confirm('هل تريد فعلاً حذف جميع البيانات المخزنة؟ هذا الإجراء لا يمكن التراجع عنه.')) {
                localStorage.removeItem('qualityAssessmentUserData');
                localStorage.removeItem('qualityAssessmentResults');
                localStorage.removeItem('qualityComplaintDraft');
                localStorage.removeItem('qualityComplaints');
                
                userData = {};
                previousResults = [];
                complaintDraft = null;
                
                document.getElementById('userName').value = '';
                document.getElementById('userEmail').value = '';
                document.getElementById('userPhone').value = '';
                document.getElementById('userDepartment').value = '';
                document.getElementById('userPosition').value = '';
                document.getElementById('userExperience').value = '';
                document.getElementById('savedDataIndicator').style.display = 'none';
                
                document.getElementById('complaintType').value = '';
                document.getElementById('complaintTitle').value = '';
                document.getElementById('complaintMessage').value = '';
                document.getElementById('complaintPriority').value = 'عادية';
                document.getElementById('complaintSavedIndicator').style.display = 'none';
                
                alert('تم حذف جميع البيانات بنجاح!');
                
                goToServiceSelection();
            }
        }
    </script>
</body>
</html>
